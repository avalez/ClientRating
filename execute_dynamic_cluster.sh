#!/bin/sh

WLST=$ORACLE_HOME/oracle_common/common/bin/wlst.sh

cd build/

echo ''
echo '   ##########################################################   '
echo '   ------------------   Building project   ------------------   '
echo '   ##########################################################   '
echo ''
bash ./buildForCluster.sh

echo ''
echo '   ##########################################################   '
echo '   -----------------   Performing cleanup   -----------------   '
echo '   ##########################################################   '
echo ''
rm -r /opt/wls/domain

echo ''
echo '   ##########################################################   '
echo '   ------------------   Creating domain   -------------------   '
echo '   ##########################################################   '
echo ''
$WLST create-domain.py

echo ''
echo '   ##########################################################   '
echo '   --------------   Starting WebLogic server   --------------   '
echo '   ##########################################################   '
echo ''
$WLST start-domain.py

echo ''
echo '   ##########################################################   '
echo '   -----------------   Creating cluster   -------------------   '
echo '   ##########################################################   '
echo ''
$WLST create-cluster.py

echo ''
echo '   ##########################################################   '
echo '   -----------------   Starting cluster   -------------------   '
echo '   ##########################################################   '
echo ''
$WLST start-cluster.py

echo ''
echo '   ##########################################################   '
echo '   ----------------   Creating partitions   -----------------   '
echo '   ##########################################################   '
echo ''
$WLST create-partitions.py

echo ''
echo '   ##########################################################   '
echo '   ----------------   Creating data source   ----------------   '
echo '   ##########################################################   '
echo ''
$WLST create-datasources.py

echo ''
echo '   ##########################################################   '
echo '   ----------------  Deploying application   ----------------   '
echo '   ##########################################################   '
echo ''
$WLST deployWithCluster.py

echo ''
echo '   ##########################################################   '
echo '   ----------------  Sending test request   -----------------   '
echo '   ##########################################################   '
echo ''
curl http://localhost:7001/customer-service/CustomerService-1.0-SNAPSHOT/resources/customers

echo ''
echo '   ##########################################################   '
echo '   --------------   Stopping WebLogic server   --------------   '
echo '   ##########################################################   '
echo ''
$WLST stop-clustered-domain.py

cd ..